<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MD_YX5300 Library: Message Flow Management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="MajicDesigns_Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MD_YX5300 Library
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Library for YX5300 MP3 player IC</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page_software.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Message Flow Management </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="YX5300_Board_Layout.jpg" alt="YX5300_Board_Layout.jpg"/>
<div class="caption">
YX5300 Board Layout</div></div>
 <h2>Communications Format </h2>
<p>The MP3 module communicates using asynchronous RS232 serial communication at 9600 bps, 8 data bits, No parity, 1 stop bit, no flow control.</p>
<p>Flow control is implemented using a serial RQST/RESP protocol based on data packets with the following byte format:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone" colspan="8">Packet Format (bytes)   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Start  </td><td class="markdownTableBodyNone">Version  </td><td class="markdownTableBodyNone">Length  </td><td class="markdownTableBodyNone">Command  </td><td class="markdownTableBodyNone">Feedback  </td><td class="markdownTableBodyNone">DataHi  </td><td class="markdownTableBodyNone">DataLo  </td><td class="markdownTableBodyNone">End   </td></tr>
</table>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Byte  </th><th class="markdownTableHeadRight">Value  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Start  </td><td class="markdownTableBodyRight">0x7e  </td><td class="markdownTableBodyLeft">The start of each packet, used for synchronization.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Version  </td><td class="markdownTableBodyRight">0xff  </td><td class="markdownTableBodyLeft">Always the same value in this implementation.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Length  </td><td class="markdownTableBodyRight">0x06  </td><td class="markdownTableBodyLeft">Number of bytes between Start and End.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Command  </td><td class="markdownTableBodyRight">0x??  </td><td class="markdownTableBodyLeft">Command code for required action.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Feedback  </td><td class="markdownTableBodyRight">0x01  </td><td class="markdownTableBodyLeft">Set to 1 for protocol feedback, 0 for none.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">DataHi  </td><td class="markdownTableBodyRight">0x??  </td><td class="markdownTableBodyLeft" rowspan="2">Length-4 data bytes = 2 in this implementation.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">DataLo  </td><td class="markdownTableBodyRight">0x??   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">End  </td><td class="markdownTableBodyRight">0xef  </td><td class="markdownTableBodyLeft">The end of each packet.   </td></tr>
</table>
<p>The message flow between the device and MCU is be displayed on the Serial Monitor by the library when the C++ macro define LIBDEBUG is set to 1 in the main code file.</p>
<h2>Sending and Receiving Serial Messages </h2>
<p>This library manages the serial interface to the TX5300 by taking care of sending and receiving the serial messages. The MP3 Player responds to command requests but it also sends unsolicited messages when certain events occur (eg, TF card removed or inserted). These unsolicited messages may be important to the application so the library implements mechanisms that allow the application to process the relevant notification data by placing it in a cbData structure.</p>
<p>How the cbData structure is received by the application is flexible and depends on the setSynchronous() setting and whether a callback is defined. This is summarized in the table below and explained in the text that follows.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight"></th><th class="markdownTableHeadLeft">Callback  </th><th class="markdownTableHeadLeft">Polled   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight" rowspan="2">Sync  </td><td class="markdownTableBodyLeft"><em>unsol</em>: callback  </td><td class="markdownTableBodyLeft"><em>unsol</em>: check()   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><em>resp</em>: ret status  </td><td class="markdownTableBodyLeft"><em>resp</em>: ret status   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight" rowspan="2">Async  </td><td class="markdownTableBodyLeft"><em>unsol</em>: callback  </td><td class="markdownTableBodyLeft"><em>unsol</em>: check()   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><em>resp</em>: callback  </td><td class="markdownTableBodyLeft"><em>resp</em>: check()   </td></tr>
</table>
<p>The first choice is whether to process the message in line with the calling sequence (synchronous) or separately (asynchronously):</p><ul>
<li><b>Synchronous</b>: The command message is sent and the code waits for the response before returning to the calling application. This is relatively inefficient of CPU time as it involves a busy wait, but is easy to implement in the application and is good for simple applications</li>
<li><b>Asynchronous</b>: The command message is sent and the library immediately returns. The response message is processed as it returns and the calling application can continue to run while this happens. Once the response is received, the calling can be notified through a callback or polled status (see below).</li>
</ul>
<p>Independently of the sync/async mode, the application can choose to be informed received messages are ready to process either by:</p><ul>
<li><b>Polling</b>: The return status of the check() method is used as the signal that an unsolicited message has been received. In synchronous mode the return code for the method invoked will be the status of check() for that request.</li>
<li><b>Callback</b>: If a callback function is defined (see setCallback()), every unsolicited message received will be processed through the callback mechanism. In Synchronous mode, both the callback and the return code for the method invoked will signal receipt of the same message, so the application code should guard against processing the message twice. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Arduino Serial MP3 Player</a></li>
    <li class="footer">Generated on Thu Jul 19 2018 17:14:38 for MD_YX5300 Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
